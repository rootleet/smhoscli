<?php require 'config/inc/core.php' ?>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>SMHOS - CLI</title>
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/general.css">
</head>


<body>
    <?php if (!is_logged_in('cli_login')): ?>
        <div class="w-100 h-100 bg-dark d-flex flex-wrap align-content-center justify-content-center overflow-hidden">

            <form method="post" action="config/process/user_mgmt.php" class="w-25">

                <p class="text-light text-center"><strong>Welcome!! Please Login</strong></p>



                <div class="input-group mb-2">
                    <input value="<?php if (isset($_SESSION['clerk_code'])){echo $_SESSION['clerk_code'];} ?>" class="form-control font-weight-bold" type="text" autocomplete="off" placeholder="Code" name="clerk_code" required>
                </div>

                <div class="input-group mb-2">
                    <input class="form-control font-weight-bold" type="password" autocomplete="off"  placeholder="Key" name="clerk_key" required>
                </div>

                <!--KEYS-->
                <div class="w-100">
                    <button type="submit" name="login" class="btn w-100 btn-success key_number_hw font-weight-bolder">LOGIN</button>
                </div>

                <div class="w-100 key_number_hw">
                    <span class="text-danger"><?php show_error() ?></span>
                </div>



            </form>

        </div>
    <?php endif; ?>

    <?php if (is_logged_in('cli_login')): ?>

        <?php if ($view === 'welcome'): ?>
            <div id="welcome" class="h-100 w-100">

            <header class="d-flex flex-wrap pl-5 pr-5 align-content-center">

                <div class="w-100 h-100 d-flex flex-wrap align-content-center justify-content-center">
                    <kbd><?php echo $my_code; ?></kbd>
                </div>




            </header>

            <article class="overflow-hidden d-flex flex-wrap align-content-center justify-content-center">
                <div class="container d-flex flex-wrap align-content-center justify-content-center">

                    <button onclick="location.href='config/process/switch.php?tri=bill'" class="btn f_size_xx_large m-2 font-weight-bolder btn-black w-30 main_cards">
                        Billing
                    </button>

                    <button class="btn f_size_xx_large m-2 font-weight-bolder btn-report w-30 main_cards">
                        Reports
                    </button>

                    <button class="btn f_size_xx_large m-2 font-weight-bolder btn-setup w-30 main_cards">
                        Company Setup
                    </button>

                    <button class="btn f_size_xx_large m-2 font-weight-bolder btn-settings w-30 main_cards">
                        Master
                    </button>

                    <button class="btn f_size_xx_large m-2 font-weight-bolder btn-lg w-30 main_cards">
                        Z-Report
                    </button>

                    <button onclick="location.href='config/process/switch.php?tri=logout'" class="btn f_size_xx_large m-2 font-weight-bolder btn-outline-danger w-30 main_cards">
                        Exit
                    </button>

                </div>
            </article>

        </div>
        <?php endif; ?>

        <?php if ($view === 'bill'): ?>
            <div class="container-fluid p-1 h-100 overflow-hidden bg-black">

                <form action="config/process/bill_processing.php" method="post" class="row no-gutters h-100">
                    <!--LEF PANE-->
                    <div class="col-sm-2 p-2">
                       <div class="w-100 h-90 d-flex flex-wrap align-content-start justify-content-between">

                           <!--NEW BOOKING-->
                            <div class="bill-button p-1">
                                <button onclick="location.href='config/process/switch.php?main=bill'" class="btn <?php if ($main === 'bill'){echo 'btn-bill-active';}else{echo 'btn-bill';} ?> p-0 w-100 h-100">

                                    <div class="w-100 h-100 d-flex flex-wrap align-content-center justify-content-center">

                                        <div class="w-100">
                                            <img src="<?php echo image_src('assets/icons/general/booking.png') ?>" class="img-fluid mb-1 bill-button-icon">
                                            <p class="f_size_small font-weight-bold m-0">New Booking</p>
                                        </div>

                                    </div>

                                </button>
                            </div>

                           <!--PAYMENTS-->
                           <div class="bill-button p-1">
                               <button onclick="location.href='config/process/switch.php?main=payment'" class="btn <?php if ($main === 'payment'){echo 'btn-bill-active';}else{echo 'btn-bill';} ?> p-0 w-100 h-100">

                                   <div class="w-100 h-100 d-flex flex-wrap align-content-center justify-content-center">

                                       <div class="w-100">
                                           <img src="<?php echo image_src('assets/icons/general/payment.png') ?>" class="img-fluid bill-button-icon">
                                           <p class="f_size_small font-weight-bold m-0">Make Payment</p>
                                       </div>

                                   </div>

                               </button>
                           </div>



                           <!--Check In-->
                           <div class="bill-button p-1">
                               <button onclick="location.href='config/process/switch.php?main=check_in'" class="btn <?php if ($main === 'check_in'){echo 'btn-bill-active';}else{echo 'btn-bill';} ?> p-0 w-100 h-100">

                                   <div class="w-100 h-100 d-flex flex-wrap align-content-center justify-content-center">

                                       <div class="w-100">
                                           <img src="<?php echo image_src('assets/icons/general/check_in.png') ?>" class="img-fluid bill-button-icon">
                                           <p class="f_size_small font-weight-bold m-0">Check In</p>
                                       </div>

                                   </div>

                               </button>
                           </div>

                           <!--CHECK OUT-->
                           <div class="bill-button p-1">
                               <button onclick="location.href='config/process/switch.php?main=check_out'" class="btn <?php if ($main === 'check_out'){echo 'btn-bill-active';}else{echo 'btn-bill';} ?> p-0 w-100 h-100">

                                   <div class="w-100 h-100 d-flex flex-wrap align-content-center justify-content-center">

                                       <div class="w-100">
                                           <img src="<?php echo image_src('assets/icons/general/check_out.png') ?>" class="img-fluid bill-button-icon">
                                           <p class="f_size_small font-weight-bold m-0">Check Out</p>
                                       </div>

                                   </div>

                               </button>
                           </div>

                           <!--RECALL-->
                           <div class="bill-button p-1">
                               <button onclick="location.href='config/process/switch.php?main=recall'" class="btn <?php if ($main === 'recall'){echo 'btn-bill-active';}else{echo 'btn-bill';} ?> p-0 w-100 h-100">

                                   <div class="w-100 h-100 d-flex flex-wrap align-content-center justify-content-center">

                                       <div class="w-100">
                                           <img src="<?php echo image_src('assets/icons/general/recall_bill.png') ?>" class="img-fluid bill-button-icon">
                                           <p class="f_size_small font-weight-bold m-0">Recall Bill</p>
                                       </div>

                                   </div>

                               </button>
                           </div>


                       </div>

                        <!--EXIT-->
                        <div class="w-100 p-1 h-10">
                            <button onclick="location.href='config/process/switch.php?tri=welcome'" class="btn rounded-0 btn-danger w-100 h-100">
                                Exit
                            </button>
                        </div>
                    </div>

                    <!--MIDDLE PANE-->
                    <div class="col-sm-6 p-2">

                        <div class="w-100 h-100 bg-dark rounded">

                            <?php if($main === 'none'): ?>

                                <div class="w-100 h-100 d-flex flex-wrap align-content-center justify-content-center">
                                    <p class="hover_large">No Function</p>
                                </div>

                            <?php endif; ?>

                            <?php if($main === 'bill'): ?>

                                <div class="w-100 p-2 h-100">
                                    <!--CATEGORIES-->
                                    <div class="w-100 d-flex flex-wrap justify-content-between h-40">

                                        <?php while ($cat = $cat_stmt->fetch(PDO::FETCH_ASSOC)): ?>
                                            <button data-toggle="pill" class="btn cat_box_shadow btn-traditional inside-button m-1 font-weight-bolder rounded-0"><?php echo $cat['name'] ?></button>
                                        <?php endwhile; ?>

                                    </div>

                                    <!--CATEGORY CONTAINERS-->
                                    <div class="w-100 h-60 facilities">

                                        <div class="w-100 d-flex flex-wrap align-content-start justify-content-start h-100">

                                            <?php if ($facilities_count < 1): ?>
                                                <div class="w-100 h-100 d-flex flex-wrap align-content-center justify-content-center">
                                                    <p class="hover_large">No Facility</p>
                                                </div>
                                            <?php endif; ?>

                                            <?php if ($facilities_count > 0): ?>
                                                <?php while ($facility = $facilities_stmt->fetch(PDO::FETCH_ASSOC)): ?>
                                                    <?php $id = $facility['id']; ?>
                                                    <div class="inside-facility p-1">
                                                        <div data-toggle="modal" data-target="#addToBill" oncontextmenu="show('#<?php echo md5($id) ?>details')"  class="btn btn-facility d-flex flex-wrap align-content-center justify-content-center rounded-0 font-weight-bold w-100 h-100"><?php echo $facility['name'] ?></div>
                                                    </div>

                                                    <!--add to bill modal-->
                                                    <div class="modal text-dark fade" id="addToBill">
                                                        <div class="modal-dialog modal-dialog-centered">
                                                            <div class="modal-content">
                                                                <div class="modal-header">
                                                                    <strong class="modal-title">Adding</strong>
                                                                    <button class="close" data-dismiss="modal">&times;</button>
                                                                </div>
                                                                <div class="modal-body p-2">
                                                                    <div class="w-75 mx-auto">
                                                                        <div class="input-group mb-2">
                                                                            <div class="input-group-prepend w-30">
                                                                                <span class="input-group-text w-100">Checkin Date</span>
                                                                            </div>
                                                                            <input class="form-control" type="date" name="checkin_date" autocomplete="off">
                                                                        </div>
                                                                        <div class="input-group mb-2">
                                                                            <div class="input-group-prepend w-30">
                                                                                <span class="input-group-text w-100">Checkout Date</span>
                                                                            </div>
                                                                            <input class="form-control" type="date" name="checkout_date" autocomplete="off">
                                                                        </div>
                                                                        <hr>
                                                                        <div class="mb-2">
                                                                            <label>Special Request</label>
                                                                            <textarea rows="3" class="form-control" name="special_request" placeholder="Special Request"></textarea>
                                                                        </div>

                                                                        <!--HIDDEN-->
                                                                        <input type="text">

                                                                        <div class="w-100 text-center">
                                                                            <button name="add_to_bill" class="btn btn-outline-success rounded-0">ADD</button>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <!--VIEW FACILITY DETAILS MODAL-->
                                                    <div class="modal fade text-dark" id="<?php echo md5($id) ?>details">
                                                        <div class="modal-dialog">
                                                            <div class="modal-content">
                                                                <div class="modal-header">
                                                                    <strong class="modal-title"><?php echo $facility['name'] ?></strong>
                                                                    <button class="close" data-dismiss="modal">&times;</button>
                                                                </div>

                                                                <div class="modal-body p-2">
                                                                    <div class="table-responsive-sm">
                                                                       <table class="table table-striped table-hover">
                                                                           <tbody>
                                                                                <tr>
                                                                                    <td class="f_size_small"><strong>Price</strong></td>
                                                                                    <td class="f_size_small">GHS 0.00</td>
                                                                                </tr>
                                                                                <tr>
                                                                                    <td class="f_size_small"><strong>Available</strong></td>
                                                                                    <td class="f_size_small">Yes <kbd>20</kbd></td>
                                                                                </tr>
                                                                                <?php
                                                                                    //get utility for facility
                                                                                    $util_sql = "select COLUMN_NAME from information_schema.columns where table_name='facilities' and column_name like 'util%'";
                                                                                    $util_exe = $route->prepare($util_sql);
                                                                                    $util_exe->execute();
                                                                                    while($util = $util_exe->fetch(PDO::FETCH_ASSOC)):
                                                                                    $u_name = $util['COLUMN_NAME'];
                                                                                    $utility = explode('_',$util['COLUMN_NAME'])[1];
                                                                                ?>

                                                                                    <tr>
                                                                                        <td class="f_size_small"><strong><?php echo $utility ?></strong></td>
                                                                                        <td class="f_size_small">
                                                                                            <?php
                                                                                                //get row
                                                                                                $get_util_sql = query("SELECT `$u_name` FROM `facilities` WHERE `id` = $id", $route );
                                                                                                if ($get_util_sql[$u_name] === 0):
                                                                                             ?>

                                                                                            <img class="img-fluid" src="assets/icons/general/wrong.png">

                                                                                            <?php else:?>
                                                                                                <img class="img-fluid" src="assets/icons/general/approved.png">
                                                                                            <?php endif; ?>
                                                                                        </td>
                                                                                    </tr>

                                                                                <?php endwhile; ?>
                                                                           </tbody>
                                                                       </table>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                <?php endwhile; ?>
                                            <?php endif; ?>

                                        </div>

                                    </div>

                                </div>

                            <?php endif; ?>

                        </div>

                    </div>

                    <!--RIGHT PAGE-->
                    <div class="col-sm-4 p-2">

                        <?php if($main === 'bill'): ?>

                        <div class="w-100 h-100 overflow-hidden bg-dark rounded">

                            <!--TOP-->
                            <div class="w-100 overflow-hidden h-60">

                                <header class="bg-dark-x pl-1 pr-1 d-flex flex-wrap justify-content-between align-content-center">
                                    <strong>Bill 12</strong>
                                    <i class="f_size_small text-center text-bx"><?php echo $my_code ?></i>
                                    <p class="m-0 text-bx">01/01/0011</p>
                                </header>

                                <article class="d-flex p-1 flex-wrap">

                                    <!--BILLING DETAILS-->
                                    <div class="w-70 h-100 bg-bill-default">

                                        <header class="bg-bill-header p-1 container">


                                            <div class="row h-100 no-gutters w-100">
                                                <div class="col-sm-7 h-100 d-flex flex-wrap align-content-center pl-1">
                                                    <p class="m-0 font-weight-bold">Item</p>
                                                </div>
                                                <div class="col-sm-2 h-100 d-flex flex-wrap align-content-center">
                                                    <p class="m-0 font-weight-bold">QTY</p>
                                                </div>
                                                <div class="col-sm-3 h-100 d-flex flex-wrap align-content-center pl-1">
                                                    <p class="m-0 font-weight-bold">Price</p>
                                                </div>
                                            </div>

                                        </header>

                                        <article>
                                            <!--BILL ITEMS-->
                                            <div class="p-1 h-85 container">
                                                <?php

                                            $bill_count = 0;
                                            while ($bill_count < count($_SESSION['bill_item']))
                                            {
                                                $d = $_SESSION['bill_item'][$bill_count];
                                                $facility = $d[0];
                                                $q_details = $d[1];

                                                $quantity = explode(':',$q_details)[0];
                                                $duration = explode(':',$q_details)[1];

                                        ?>
                                                <div class="row no-gutters w-100">
                                                    <div class="col-sm-7 h-100 d-flex flex-wrap align-content-center pl-1">
                                                        <p class="m-0 f_size_small">
                                                            <?php echo get_row("facilities", "`id` = $facility", $route)['name'] ?>
                                                        </p>
                                                    </div>
                                                    <div class="col-sm-2 h-100 d-flex flex-wrap align-content-center">
                                                        <p class="m-0 f_size_small"><?php echo $quantity ?> <sup class="badge badge-info"><?php echo $duration ?></sup></p>
                                                    </div>
                                                    <div class="col-sm-3 h-100 d-flex flex-wrap align-content-center pl-1">
                                                        <p class="m-0 f_size_small">
                                                            <?php
                                                                $cost = get_row("facilities", "`id` = $facility", $route)['cost'] * $duration;
                                                                if(count(explode('.',$cost)) > 1)
                                                                {
                                                                    echo $cost;
                                                                }
                                                                else
                                                                {
                                                                    echo $cost.'.00';
                                                                }
                                                            ?>
                                                        </p>
                                                    </div>
                                                </div>

                                                <?php
                                            $bill_count ++;
                                            }

                                        ?>

                                            </div>

                                            <!--INPUT FORM-->
                                            <div class="overflow-hidden w-100 border h-15">
                                                <form class="h-100">
                                                    <input type="text" class="w-100 h-100 form-control font-weight-bolder f_size_x_large rounded-0">
                                                </form>
                                            </div>
                                        </article>

                                    </div>

                                    <!--BILLING BUTTONS-->
                                    <div class="w-30 h-100 d-flex flex-wrap align-content-start justify-content-center">
                                        <button class="btn bill-in-btn btn-in rounded-0 mb-2">
                                            <img src="<?php echo image_src('assets/icons/general/cash_payment.png') ?>">
                                        </button>
                                        <button class="btn bill-in-btn btn-in rounded-0 mb-2">
                                            <img src="<?php echo image_src('assets/icons/general/card_payment.png') ?>">
                                        </button>
                                        <button class="btn bill-in-btn btn-in rounded-0 mb-2">
                                            <img src="<?php echo image_src('assets/icons/general/mobile_payment.png') ?>">
                                        </button>
                                        <button class="btn bill-in-btn btn-in rounded-0 mb-2">
                                            <img src="<?php echo image_src('assets/icons/general/cancel.png') ?>">
                                        </button>
                                        <button class="btn bill-in-btn btn-in rounded-0 mb-2">
                                            <img src="<?php echo image_src('assets/icons/general/hold_bill.png') ?>">
                                        </button>
                                    </div>

                                </article>

                            </div>

                            <!--BOTTOM-->
                            <div class="w-100 h-40 p-2 d-flex flex-wrap bg-dark-x">

                                <!--NUMBERS-->
                                <div class="w-70 h-100 p-0">
                                    <div class="w-100 h-100 p-0">
                                        <div class="d-flex flex-wrap align-content-start justify-content-between h-100 w-100">
                                            <div class="w-30 mb-3">
                                                <button class="btn w-100 key_number_hw">1</button>
                                            </div>
                                            <div class="w-30 mb-3">
                                                <button class="btn w-100 key_number_hw">2</button>
                                            </div>
                                            <div class="w-30 mb-3">
                                                <button class="btn w-100 key_number_hw">3</button>
                                            </div>
                                            <div class="w-30 mb-3">
                                                <button class="btn w-100 key_number_hw">4</button>
                                            </div>
                                            <div class="w-30 mb-3">
                                                <button class="btn w-100 key_number_hw">5</button>
                                            </div>
                                            <div class="w-30 mb-3">
                                                <button class="btn w-100 key_number_hw">6</button>
                                            </div>
                                            <div class="w-30 mb-3">
                                                <button class="btn w-100 key_number_hw">7</button>
                                            </div>
                                            <div class="w-30 mb-3">
                                                <button class="btn w-100 key_number_hw">8</button>
                                            </div>
                                            <div class="w-30 mb-3">
                                                <button class="btn w-100 key_number_hw">9</button>
                                            </div>
                                            <div class="w-30 mb-3">
                                                <button class="btn w-100 key_number_hw_light">*</button>
                                            </div>
                                            <div class="w-30 mb-3">
                                                <button class="btn w-100 key_number_hw">0</button>
                                            </div>
                                            <div class="w-30 mb-3">
                                                <button class="btn w-100 key_number_hw_light">Clear</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!--VALUES-->
                                <div class="w-30 d-flex flex-wrap align-content-between justify-content-end h-100">
                                    <!--COST PRICE-->
                                    <div class="card w-85 overflow-hidden h-30 bg-black">
                                        <div class="h-40 bg-dark text-right d-flex flex-wrap align-content-center justify-content-center font-weight-bold w-100">
                                            <p class="m-0 f_size_small">Cost</p>
                                        </div>
                                        <div class="h-60 text-right d-flex flex-wrap align-content-center justify-content-center font-weight-bold w-100">
                                            <strong>1000.00</strong>
                                        </div>
                                    </div>

                                    <!--PAID PRICE-->
                                    <div class="card w-85 overflow-hidden h-30 bg-black">
                                        <div class="h-40 bg-dark text-right d-flex flex-wrap align-content-center justify-content-center font-weight-bold w-100">
                                            <p class="m-0 f_size_small">Paid</p>
                                        </div>
                                        <div class="h-60 text-right d-flex flex-wrap align-content-center justify-content-center font-weight-bold w-100">
                                            <strong>0.00</strong>
                                        </div>
                                    </div>

                                    <!--BALANCE-->
                                    <div class="card w-85 overflow-hidden h-30 bg-black">
                                        <div class="h-40 bg-dark text-right d-flex flex-wrap align-content-center justify-content-center font-weight-bold w-100">
                                            <p class="m-0 f_size_small">Balance</p>
                                        </div>
                                        <div class="h-60 text-right d-flex flex-wrap align-content-center justify-content-center font-weight-bold w-100">
                                            <strong>0.00</strong>
                                        </div>
                                    </div>
                                </div>

                            </div>

                        </div>

                        <?php endif; ?>


                    </div>

                </form>

            </div>
        <?php endif; ?>

    <?php endif; ?>

</body>

</html>
<!-- jQuery library -->
<script src="js/jquery.min.js"></script>

<!-- Popper JS -->
<script src="js/popper.min.js"></script>

<!-- Latest compiled JavaScript -->
<script src="js/bootstrap.min.js"></script>

<script>

    $(document).on({
        "contextmenu": function(e) {
            console.log("ctx menu button:", e.which);

            // Stop the context menu
            e.preventDefault();
        },
        "mousedown": function(e) {
            console.log("normal mouse down:", e.which);
        },
        "mouseup": function(e) {
            console.log("normal mouse up:", e.which);
        }
    });

    //show details finction
    function show(modal)
    {
        $(modal).modal('show');
    }

</script>